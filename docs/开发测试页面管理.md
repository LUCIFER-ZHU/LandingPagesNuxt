# 开发测试页面管理指南

## 概述

本项目使用 `app/pages/dev/` 目录来管理**仅用于开发测试的页面**，这些页面不会出现在生产环境中。

## 目录结构

```
app/pages/
├── dev/                          # 开发测试页面目录
│   ├── test-cookie.vue          # Cookie Consent 测试页面
│   └── README.md                # 开发目录说明
├── account/                      # 正常业务页面
├── index.vue                     # 正常业务页面
└── ...
```

## 工作原理

### Nuxt 配置 (nuxt.config.ts)

```typescript
hooks: {
    'pages:extend'(pages) {
        if (process.env.NODE_ENV === 'production') {
            // 移除所有 /dev/ 路径的页面
            const pagesToRemove = pages.filter(page => page.path.includes('/dev'))
            pagesToRemove.forEach(page => {
                pages.splice(pages.indexOf(page), 1)
            })
        }
    }
}
```

### 环境差异

| 环境 | `/dev/*` 页面 | 访问方式 |
|------|--------------|---------|
| **开发环境** (`npm run dev`) | ✅ 可访问 | `http://localhost:3000/dev/test-cookie` |
| **生产环境** (`npm run build`) | ❌ 不存在 | 404 Not Found |

## 使用场景

### 适合放在 `/dev/` 的页面

✅ **适合**：
- 功能测试页面（如 Cookie 测试）
- 组件展示页面
- API 调试页面
- 开发工具页面
- 性能测试页面
- 原型设计页面

❌ **不适合**：
- 需要在生产环境使用的页面
- 用户会访问的任何页面
- 包含生产环境配置的页面

## 如何添加新的测试页面

### 1. 创建页面文件

```bash
# 创建新的测试页面
touch app/pages/dev/test-my-feature.vue
```

### 2. 编写测试页面

```vue
<!-- app/pages/dev/test-my-feature.vue -->
<template>
    <div class="test-page">
        <h1>我的功能测试</h1>
        <p>这个页面仅在开发环境可用</p>
        
        <!-- 测试代码 -->
    </div>
</template>

<script setup lang="ts">
// 测试逻辑
</script>
```

### 3. 访问测试页面

```bash
# 启动开发服务器
npm run dev

# 访问
# http://localhost:3000/dev/test-my-feature
```

## 验证生产环境排除

### 方法 1: 本地构建预览

```bash
# 构建生产版本
npm run build

# 预览生产版本
npm run preview

# 尝试访问测试页面（应该返回 404）
# http://localhost:3000/dev/test-cookie
```

### 方法 2: 检查构建输出

```bash
# 构建后检查 .output 目录
npm run build

# 测试页面不应该出现在构建输出中
ls -la .output/public/_nuxt/
```

## 最佳实践

### 1. 命名规范

```
app/pages/dev/
├── test-*.vue              # 功能测试页面
├── demo-*.vue              # 组件演示页面
├── debug-*.vue             # 调试工具页面
└── prototype-*.vue         # 原型设计页面
```

### 2. 添加页面说明

```vue
<template>
    <div class="dev-page">
        <!-- 添加醒目的开发环境标识 -->
        <div class="dev-banner">
            🚧 开发测试页面 - 仅在开发环境可用
        </div>
        
        <!-- 测试内容 -->
    </div>
</template>
```

### 3. 清理不需要的测试页面

定期检查并删除不再使用的测试页面：

```bash
# 查看所有测试页面
ls app/pages/dev/

# 删除不需要的测试页面
rm app/pages/dev/test-old-feature.vue
```

### 4. 文档记录

在 `app/pages/dev/README.md` 中记录每个测试页面的用途：

```markdown
## 当前页面

- `/dev/test-cookie` - Cookie Consent 功能测试页面
- `/dev/test-auth` - 认证系统测试页面
- `/dev/test-payment` - 支付流程测试页面
```

## 其他方案对比

### 方案 1: `/pages/dev/` 目录（当前使用）✅

**优点**：
- 自动路由，无需手动配置
- 开发体验好，直接访问
- 生产环境自动排除
- 代码组织清晰

**缺点**：
- 需要配置 Nuxt hooks
- 代码仍在仓库中（但不影响生产）

### 方案 2: 单独的测试项目

**优点**：
- 完全独立
- 可以使用不同的依赖

**缺点**：
- 需要维护两个项目
- 不能直接测试真实的组件和 API
- 开发效率低

### 方案 3: 条件渲染

```vue
<template>
    <div v-if="isDev">
        <!-- 测试内容 -->
    </div>
</template>
```

**优点**：
- 简单直接

**缺点**：
- 测试代码仍然打包到生产环境
- 增加打包体积
- 不推荐 ❌

## 常见问题

### Q: 测试页面的代码会被打包到生产环境吗？

A: 不会。虽然代码在仓库中，但由于 Nuxt hooks 配置，这些页面不会被包含在生产构建中。

### Q: 可以在测试页面中使用生产环境的组件吗？

A: 可以。测试页面可以导入和使用项目中的任何组件、composables、stores 等。

### Q: 如何保护敏感信息？

A: 虽然生产环境访问不到，但代码仍在 Git 仓库中，因此：
- ❌ 不要在测试页面中硬编码敏感信息（密码、密钥等）
- ✅ 使用环境变量或开发环境配置
- ✅ 添加 `.gitignore` 排除敏感测试数据

### Q: CI/CD 构建时会包含测试页面吗？

A: 不会。只要 `NODE_ENV=production`，测试页面就会被自动排除。

## 总结

使用 `app/pages/dev/` 目录管理测试页面是一个简单、高效、安全的方案：

- ✅ 开发环境方便测试
- ✅ 生产环境自动排除
- ✅ 代码组织清晰
- ✅ 不影响生产性能
- ✅ 易于维护和扩展

遵循本指南，可以更好地管理项目的测试和开发页面！

